## ğŸˆ Spring + MyBatis

***

<br>

### :pushpin: MyBatisë€?

- SQL ê³¼ JAVA ê°ì²´ë¥¼ ë§¤í•‘í•˜ëŠ” ì‚¬ìƒì—ì„œ ê°œë°œëœ DB ì ‘ê·¼ìš© í”„ë ˆì„ì›Œí¬
- ê°ì²´ ì§€í–¥ ì–¸ì–´ì¸ ìë°”ì˜ ê´€ê³„í˜• DB í”„ë¡œê·¸ë˜ë°ì„ ì¢€ ë” ì‰½ê²Œ êµ¬í˜„í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” í”„ë ˆì„ì›Œí¬
- **JDBC**ë¥¼ í†µí•´ DBì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ì‘ì—…ì„ ìº¡ìŠí™”
  - **JDBC** : ìë°”ì—ì„œ DB í”„ë¡œê·¸ë˜ë°ì„ í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” API
- ì¼ë°˜ SQL ì¿¼ë¦¬, ì €ì¥ í”„ë¡œì‹œì €, ê³ ê¸‰ ë§¤í•‘ ì§€ì›
- ëª¨ë“  JDBC ì½”ë“œ ë° ë§¤ê°œ ë³€ìˆ˜ì˜ ì¤‘ë³µ ì‘ì—… ì œê±° 
- í”„ë¡œê·¸ë¨ì— SQL ì¿¼ë¦¬ë“¤ì„ í•œ êµ¬ì„±íŒŒì¼ì— êµ¬ì„±
  - í”„ë¡œê·¸ë¨ ì½”ë“œì™€ SQL ë¶„ë¦¬ 
- ì£¼ìš” ì»´í¬ë„ŒíŠ¸
  - MyBatis Library
  - Spring Framework ì—°ë™ì„ ìœ„í•œ MyBatis-Spring Library

<br> 

### :pushpin: MyBatis ì¥ì 

- SQL ì˜ ì²´ê³„ì ì¸ ê´€ë¦¬ ê°€ëŠ¥
  - xml ì„¤ì • íŒŒì¼
  - Annotation
- ìë°” ê°ì²´ì™€ SQL ì…ì¶œë ¥ ê°’ì˜ Binding
- ë™ì  SQL ì¡°í•©

<br>

### :pushpin: MyBatis Library ì£¼ìš” ì»´í¬ë„ŒíŠ¸

- **MyBatis ì„¤ì • íŒŒì¼(xml)**
- **SqlSessionFactoryBuilder**
  - MyBatis ì„¤ì •íŒŒì¼(xml)ì„ ë°”íƒ•ìœ¼ë¡œ SqlSessionFactory ìƒì„±
  - SqlSessionFactoryë¥¼ ìƒì„±í•˜ëŠ” ì£¼ì²´ëŠ” **SqlSessionFactoryBuilder**
- **SqlSessionFactory**
  - SqlSession ìƒì„±ì„ ìœ„í•œ ì»´í¬ë„ŒíŠ¸ 
  - SqlSessionì„ ìƒì„±í•˜ëŠ” ì£¼ì²´ëŠ” **SqlSessionFactory**
- **SqlSession**
  - SQL ë°œí–‰ê³¼ íŠ¸ëœì­ì…˜ ê´€ë¦¬ 
- **Mapper Interface**
  - Mapping Fileê³¼ SQL ì— ëŒ€ì‘í•˜ëŠ” ìë°” ì¸í„°í˜ì´ìŠ¤ 
- **Mapping File**
  - SQLê³¼ OR ë§¤í•‘ì„ XMLì— ê¸°ìˆ  

<br>

### :pushpin: MyBatis-Spring Library ì£¼ìš” ì»´í¬ë„ŒíŠ¸

- **org.mybatis.spring.SqlSessionTemplate**
  - sqlSession Interfaceë¥¼ êµ¬í˜„ 
  - sqlSession InterfaceëŠ” MyBatisì˜ í•µì‹¬ API
  - **sqlSession ê°ì²´**ë¥¼ **DAO ê°ì²´**ì— ì˜ì¡´ê´€ê³„ ì£¼ì…ìœ¼ë¡œ ì‚¬ìš© 
  - DAO ì—­í• ì„ Mapper ê°ì²´ë¥¼ í†µí•´ ê¸°ëŠ¥ ì œê³µ 



### :pushpin: MyBatisë¥¼ í†µí•œ Spring MVC ê°ì²´ ì˜ì¡´ì„± ì „ì´ ê³¼ì •

![MyBatis](https://user-images.githubusercontent.com/55940552/117807430-96d03c80-b296-11eb-8b22-ad2c1f8816be.png) 

<br> 

### :pushpin: MyBatis ì‚¬ìš©ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

- **spring-jdbc**
  - ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” JDBC Wrapping ëª¨ë“ˆ
- **MyBatis-Spring**
  - MyBatisê°€ ì œê³µí•˜ëŠ” í”„ë ˆì„ì›Œí¬ ê°„ ì—°ë™ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **MyBatis**
  - MyBatis í”„ë ˆì„ì›Œí¬ ëª¨ë“ˆ
- **commons-dbcp**
  - Connection Pool ì§€ì› ë¼ì´ë¸ŒëŸ¬ë¦¬
- **mysql-connector-java**
  - MySQL JDBC ë¼ì´ë¸ŒëŸ¬ë¦¬ 



### :pushpin: Spring-MVC MyBatis ì‹¤ìŠµ í™˜ê²½

- **STS 4**
- **MySQL 8.0.23**
- **Java Build Path 1.8**
- **Project Facets Java 1.8**
- **pom.xml ê¸°ë³¸ ì˜ì¡´ì„± ì¶”ê°€**
  - spring-context(5.2.12.RELEASE)
  - hibernate-validator(6.2.0.FINAL)
  - Jackson-databind(2.12.1)
  - junit(4.13)
  - sl4j-api(1.7.30)
  - log4j(1.2.17)
- **pom.xml MyBatis ì—°ë™ì„ ìœ„í•œ ì˜ì¡´ì„± ì¶”ê°€**
  - spring-jdbc(5.2.12.RELEASE)
  - commons-dbcp(1.4)
  - mysql-connector-java(8.0.23)
  - Mybatis(3.5.3)
  - mybatis-spring(2.0.3)

<br> 

### :pushpin: web.xml ì„¤ì •

- CharacterEncodingFilter ì„¤ì • - í•œêµ­ì–´ ì‚¬ìš© ë¬¸ì ì¸ì½”ë”© ë°©ì‹

  ```xml
  <!-- web.xml -->
  <filter>
  	<filter-name>CharacterEncodingFilter</filter-name>
      <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
      <init-param>
      	<param-name>encoding</param-name>
          <param-value>UTF-8</param-value>
      </init-param>
  </filter>
  
  <filter-mapping>
  	<filter-name>CharacterEncodingFilter</filter-name>
      <url-pattern>/*</url-pattern>
  </filter-mapping>
  ```

<br> 

### :pushpin: MyBatis root-context.xml ì„¤ì •

1. DataSource Bean ë“±ë¡
   - ì»¤ë„¥ì…˜ í’€ ì§€ì›
2. íŠ¸ëœì­ì…˜ ê´€ë¦¬ìì˜ Bean ë“±ë¡
3. SqlSessionFactory Bean ë“±ë¡
4. SqlSessionTemplate Bean ë“±ë¡ 

```xml
<!-- root-context.xml -->
<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
	<property name="driverClassName" value="com.mysql.cj.jdbc.Driver"/>
    <property name="url" value="jdbc:mysql://127.0.0.1:3306/DBìŠ¤í‚¤ë§ˆëª…? 	allowPublicKeyRetrieval=true&amp;useUnicode=true&amp;characterEncoding=utf8&amp;
                                useSSL=false&amp;serverTimezone=UTC"/>
    <property name="username" value="DBëª…"/>
    <property name="password" value="DBë¹„ë°€ë²ˆí˜¸"/>
    <property name="maxActive" value="5"/>
</bean>

<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
	<property name="dataSource" ref="dataSource"></property>
    <property name="configLocation" value="classpath:/mybatis-config.xml"></property>
    <property name="mapperLocations" value="classpath:mappers/*Mapper.xml"></property>
</bean>

<bean id="sqlSession" class="org.mybatis.spring.SqlSessionTemplate" destroy-method="clearCache">
	<constructor-arg name="sqlSessionFactory" ref="sqlSessionFactory"></constructor-arg>
</bean>
```

<br> 

### :pushpin: MyBatis-config.xml ì„¤ì •

- MyBatisì˜ ê³µí†µì ì¸ ì„¤ì •ì„ ì§€ì •í•˜ëŠ” xml íŒŒì¼

```xml
<!-- mybatis-config.xml -->
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE configuration
PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd">

<configuration>
    <!-- type AliasesëŠ” ë§¤í•‘ íŒŒì¼ì—ì„œ ì§€ì •í•˜ëŠ” ìë°” í´ë˜ìŠ¤ì— ëŒ€í•œ ë³„ì¹­ì„ í• ë‹¹í•œë‹¤. -->
    <!-- Mapper Fileì—ì„œ parameter Typeì´ë‚˜ resultTypeì— ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ ì´ë¦„ì—ì„œ í•´ë‹¹ ë„ë©”ì¸ íŒ¨í‚¤ì§€ ëª…ì„ ìƒëµí•  ìˆ˜ ìˆìŒ -->
	<typeAliases>
    	<package name="domain íŒ¨í‚¤ì§€ ëª…"/>
    </typeAliases>
</configuration>
```

<br> 

### :pushpin: MyBatisë¥¼ ì´ìš©í•œ SQL ì‚¬ìš© ë°©ì‹ 3 ê°€ì§€

- **XMLë§Œì„ ì´ìš©í•œ SQL ë¬¸ ì„¤ì •**
  - DAOì—ì„œ XMLì„ ì°¾ì•„ì„œ ì‹¤í–‰í•˜ëŠ” ì½”ë“œ ì‘ì„±
  - SQLë¬¸ì„ ë³„ë„ì˜ xmlë¡œ ê´€ë¦¬í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì— ì í•©
  - ì½”ë“œì˜ ì–‘ì´ ë°©ëŒ€í•´ì§
- **Annotationê³¼ Interfaceë§Œì„ ì´ìš©í•œ SQL ë¬¸ ì‘ì„±**
  - DAO ì—†ì´ ê°œë°œ ê°€ëŠ¥
  - ìƒì‚°ì„± ì¦ê°€
  - ë§¤ë²ˆ ìˆ˜ì • ì‹œ ì»´íŒŒì¼ í•„ìš”
- **Interfaceì™€ XMLë¡œ ì‘ì„±ëœ SQL ë¬¸ í™œìš©**
  - ê°„ë‹¨í•œ SQLì€ ì¸í„°í˜ì´ìŠ¤ë¡œ ì²˜ë¦¬
  - ë³µì¡í•œ SQLì€ XMLë¡œ ì²˜ë¦¬
  - 2ê°€ì§€ ë°©ì‹ì˜ í˜¼ì¬ë¡œ ìœ ì§€ë³´ìˆ˜ ì‘ì—…ì— ë¶€ì í•©

<br> 

### :pushpin: XMLë§Œì„ ì´ìš©í•œ SQLë¬¸ ì„¤ì • ë°©ì‹

1. ë§¤í•‘ íŒŒì¼ ì‘ì„±(studentMapper.xml)

   - MapperëŠ” SQL ë¬¸ì„ ì €ì¥í•˜ëŠ” ê³³ì´ë‹¤.
   - Mapperë¥¼ í†µí•´ SQLë¬¸ê³¼ ê°ì²´ë¥¼ ì—°ê²°í•œë‹¤.
   - src/main/resources/mappers í´ë”ì— studentMapper.xml íŒŒì¼ ì‘ì„±

   ```xml
   <!-- mybatis-config.xml -->
   
   <?xml version="1.0" encoding="UTF-8?">
   
   <!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
   <mapper namespace="org.kpu.myweb.mapper.StudentMapper">
   	... SQLë¬¸ ì„¤ì •
   </mapper>
   ```

   ```xml
   <!-- root-context.xml -->
   <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
   	<property name="dataSource" ref="dataSource"></property>
       <property name="configLocation" value="classpath:/mybatis-config.xml"></property>
       <property name="mapperLocations" value="classpath:mappers/*Mapper.xml"></property>
   </bean>
   ```

   

